@using System;
@using H24.Definitions;

@{
    Layout = "SubpageLayout.cshtml";

    // View items and the URLs
    string notepadLoadingStatus = "notepadLoadingStatus";
    string notepadLastEditDate = "notepadLastEditDate";
    string notepadLoadLastIteration = "notepadLoadLastIteration";
    string notepadEditSaveButton = "notepadEditSaveButton";
    string notepadEditSaveStatus = "notepadEditSaveStatus";

    string urlNotes = "/api/Notes/CurrentNotes";
    string urlLastNotes = "/api/Notes/LastNotes";

    string themeSelector = "themeSelector";
    string languageSelector = "languageSelector";
}

@section StyleSheets {
    <!-- ace.js formatting -->
    <style type="text/css" media="screen">
        .editorSettings {
            width: 600px;
            height: 400px;
        }
    </style>
}

@section Content{
    <div class="card" style="width: 50rem;">
        <div class="card-header">
            Notes <small><span class="text-muted" id="@notepadLastEditDate"></span></small>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col">
                    <div class="editorSettings" id="editor">// Enter notes here</div>
                </div>
                <div class="col">
                    <!-- Values copied from https://ace.c9.io/build/kitchen-sink.html for ambience and language. -->
                    <h4>Theme</h4>
                    <select class="custom-select custom-select-sm" id="@themeSelector">
                        <optgroup label="Light">
                            <option value="chrome">Chrome</option>
                            <option value="clouds">Clouds</option>
                            <option value="crimson_editor">Crimson Editor</option>
                            <option value="dawn">Dawn</option>
                            <option value="dreamweaver">Dreamweaver</option>
                            <option value="eclipse">Eclipse</option>
                            <option selected value="github">GitHub</option>
                            <option value="textmate">TextMate</option>
                            <option value="tomorrow">Tomorrow</option>
                            <option value="xcode">XCode</option>
                            <option value="katzenmilch">KatzenMilch</option>
                            <option value="sqlserver">SQL Server</option>
                        </optgroup>
                        <optgroup label="Intermediate">
                            <option value="cobalt">Cobalt</option>
                            <option value="idle_fingers">idle Fingers</option>
                            <option value="iplastic">IPlastic</option>
                            <option value="kuroir">Kuroir</option>
                            <option value="mono_industrial">Mono Industrial</option>
                            <option value="pastel_on_dark">Pastel on dark</option>
                            <option value="solarized_light">Solarized Light</option>
                            <option value="solarized_dark">Solarized Dark</option>
                            <option value="tomorrow_night_blue">Tomorrow Night Blue</option>
                            <option value="tomorrow_night_eighties">Tomorrow Night 80s</option>
                        </optgroup>
                        <optgroup label="Dark">
                            <option value="ambiance">Ambiance</option>
                            <option value="chaos">Chaos</option>
                            <option value="clouds_midnight">Clouds Midnight</option>
                            <option value="gruvbox">Gruvbox</option>
                            <option value="gob">Green on Black</option>
                            <option value="kr_theme">krTheme</option>
                            <option value="merbivore">Merbivore</option>
                            <option value="merbivore_soft">Merbivore Soft</option>
                            <option value="monokai">Monokai</option>
                            <option value="terminal">Terminal</option>
                            <option value="tomorrow_night">Tomorrow Night</option>
                            <option value="tomorrow_night_bright">Tomorrow Night Bright</option>
                            <option value="twilight">Twilight</option>
                            <option value="vibrant_ink">Vibrant Ink</option>
                        </optgroup>
                    </select>
                    <br />
                    <h4>Language</h4>
                    <select class="custom-select custom-select-sm" id="@languageSelector">
                        <option value="abap">ABAP</option>
                        <option value="abc">ABC</option>
                        <option value="actionscript">ActionScript</option>
                        <option value="ada">ADA</option>
                        <option value="apache_conf">Apache Conf</option>
                        <option value="asciidoc">AsciiDoc</option>
                        <option value="assembly_x86">Assembly x86</option>
                        <option value="autohotkey">AutoHotKey</option>
                        <option value="batchfile">BatchFile</option>
                        <option value="bro">Bro</option>
                        <option value="c_cpp">C and C++</option>
                        <option value="c9search">C9Search</option>
                        <option value="cirru">Cirru</option>
                        <option value="clojure">Clojure</option>
                        <option value="cobol">Cobol</option>
                        <option value="coffee">CoffeeScript</option>
                        <option value="coldfusion">ColdFusion</option>
                        <option value="csharp">C#</option>
                        <option value="csound_document">Csound Document</option>
                        <option value="csound_orchestra">Csound</option>
                        <option value="csound_score">Csound Score</option>
                        <option value="css">CSS</option>
                        <option value="curly">Curly</option>
                        <option value="d">D</option>
                        <option value="dart">Dart</option>
                        <option value="diff">Diff</option>
                        <option value="dockerfile">Dockerfile</option>
                        <option value="dot">Dot</option>
                        <option value="drools">Drools</option>
                        <option value="dummy">Dummy</option>
                        <option value="dummysyntax">DummySyntax</option>
                        <option value="eiffel">Eiffel</option>
                        <option value="ejs">EJS</option>
                        <option value="elixir">Elixir</option>
                        <option value="elm">Elm</option>
                        <option value="erlang">Erlang</option>
                        <option value="forth">Forth</option>
                        <option value="fortran">Fortran</option>
                        <option value="ftl">FreeMarker</option>
                        <option value="gcode">Gcode</option>
                        <option value="gherkin">Gherkin</option>
                        <option value="gitignore">Gitignore</option>
                        <option value="glsl">Glsl</option>
                        <option value="gobstones">Gobstones</option>
                        <option value="golang">Go</option>
                        <option value="graphqlschema">GraphQLSchema</option>
                        <option value="groovy">Groovy</option>
                        <option value="haml">HAML</option>
                        <option value="handlebars">Handlebars</option>
                        <option value="haskell">Haskell</option>
                        <option value="haskell_cabal">Haskell Cabal</option>
                        <option value="haxe">haXe</option>
                        <option value="hjson">Hjson</option>
                        <option value="html">HTML</option>
                        <option value="html_elixir">HTML (Elixir)</option>
                        <option value="html_ruby">HTML (Ruby)</option>
                        <option value="ini">INI</option>
                        <option value="io">Io</option>
                        <option value="jack">Jack</option>
                        <option value="jade">Jade</option>
                        <option value="java">Java</option>
                        <option value="javascript">JavaScript</option>
                        <option value="json">JSON</option>
                        <option value="jsoniq">JSONiq</option>
                        <option value="jsp">JSP</option>
                        <option value="jssm">JSSM</option>
                        <option value="jsx">JSX</option>
                        <option value="julia">Julia</option>
                        <option value="kotlin">Kotlin</option>
                        <option value="latex">LaTeX</option>
                        <option value="less">LESS</option>
                        <option value="liquid">Liquid</option>
                        <option value="lisp">Lisp</option>
                        <option value="livescript">LiveScript</option>
                        <option value="logiql">LogiQL</option>
                        <option value="lsl">LSL</option>
                        <option value="lua">Lua</option>
                        <option value="luapage">LuaPage</option>
                        <option value="lucene">Lucene</option>
                        <option value="makefile">Makefile</option>
                        <option value="markdown">Markdown</option>
                        <option value="mask">Mask</option>
                        <option value="matlab">MATLAB</option>
                        <option value="maze">Maze</option>
                        <option value="mel">MEL</option>
                        <option value="mushcode">MUSHCode</option>
                        <option value="mysql">MySQL</option>
                        <option value="nix">Nix</option>
                        <option value="nsis">NSIS</option>
                        <option value="objectivec">Objective-C</option>
                        <option value="ocaml">OCaml</option>
                        <option value="pascal">Pascal</option>
                        <option value="perl">Perl</option>
                        <option value="pgsql">pgSQL</option>
                        <option value="php">PHP</option>
                        <option value="pig">Pig</option>
                        <option value="powershell">Powershell</option>
                        <option value="praat">Praat</option>
                        <option value="prolog">Prolog</option>
                        <option value="properties">Properties</option>
                        <option value="protobuf">Protobuf</option>
                        <option value="python">Python</option>
                        <option value="r">R</option>
                        <option value="razor">Razor</option>
                        <option value="rdoc">RDoc</option>
                        <option value="red">Red</option>
                        <option value="rhtml">RHTML</option>
                        <option value="rst">RST</option>
                        <option value="ruby">Ruby</option>
                        <option value="rust">Rust</option>
                        <option value="sass">SASS</option>
                        <option value="scad">SCAD</option>
                        <option value="scala">Scala</option>
                        <option value="scheme">Scheme</option>
                        <option value="scss">SCSS</option>
                        <option value="sh">SH</option>
                        <option value="sjs">SJS</option>
                        <option value="smarty">Smarty</option>
                        <option value="snippets">snippets</option>
                        <option value="soy_template">Soy Template</option>
                        <option value="space">Space</option>
                        <option value="sql">SQL</option>
                        <option value="sqlserver">SQLServer</option>
                        <option value="stylus">Stylus</option>
                        <option value="svg">SVG</option>
                        <option value="swift">Swift</option>
                        <option value="tcl">Tcl</option>
                        <option value="tex">Tex</option>
                        <option value="text" selected>Text</option>
                        <option value="textile">Textile</option>
                        <option value="toml">Toml</option>
                        <option value="tsx">TSX</option>
                        <option value="twig">Twig</option>
                        <option value="typescript">Typescript</option>
                        <option value="vala">Vala</option>
                        <option value="vbscript">VBScript</option>
                        <option value="velocity">Velocity</option>
                        <option value="verilog">Verilog</option>
                        <option value="vhdl">VHDL</option>
                        <option value="wollok">Wollok</option>
                        <option value="xml">XML</option>
                        <option value="xquery">XQuery</option>
                        <option value="yaml">YAML</option>
                        <option value="django">Django</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="card-footer">
            <div class="row justify-content-between">
                <div class="col-auto">
                    <button id="@notepadEditSaveButton" type="button" class="btn btn-secondary btn-sm">Save</button>
                    <button id="@notepadLoadLastIteration" type="button" class="btn btn-danger btn-sm">Rollback</button>
                </div>
                <div class="col-auto">
                    <span class="alert-warning" role="alert" id="@notepadLoadingStatus"></span>
                </div>
            </div>
        </div>
    </div>
}

@section Scripts{
    <script type="text/javascript" src="~/Lib/ace-1.2.9/ace.js"></script>
    <script type="text/javascript" src="~/Lib/es6-promise-auto-4.2/es6-promise.auto.min.js"></script>
    <script type="text/javascript" src="~/Lib/axios-0.17/axios.min.js"></script>

    <!-- Enable the nice, fancy editor. -->
    <script type="text/javascript">

        var editor = ace.edit("editor");
        editor.setTheme("ace/theme/github");
        editor.session.setMode("ace/mode/text");
        editor.session.setUseWorker(false);

        // Change the theme and language when the selectors change.
        $("#@themeSelector").on('change', function (e) {
            var optionSelected = $("option:selected", this);
            editor.setTheme("ace/theme/" + this.value);
        });

        $("#@languageSelector").on('change', function (e) {
            var optionSelected = $("option:selected", this);
            editor.session.setMode("ace/mode/" + this.value);
        });

        // Save the edits when requested
        $("#@notepadEditSaveButton").click(function () {
            $("#@notepadEditSaveStatus").text("Saving...");

            axios.post('@urlNotes', editor.getValue())
                .then(function (data) {
                    $("#@notepadEditSaveStatus").text(data);
                })
                .catch(function (data) {
                    $("#@notepadEditSaveStatus").text(data.responseText);
                });
        });

        // Load with the last iteration when requested
        $("#@notepadLoadLastIteration").click(function () {
            $("#@notepadLoadingStatus").text("Loading last iteration...");

            axios.get('@urlLastNotes')
                .then(function (response) {
                    editor.setValue(response.data);
                    $("#@notepadLoadingStatus").text("Last iteration loaded successfully!");
                })
                .catch(function (data) {
                    $("#@notepadLoadingStatus").text(data);
                });
        });

        // Runs at startup to load the user's notes.
        function loadUserNotes() {
            axios.get('@urlNotes')
                .then(function (data) {
                    editor.session.setValue(data.data.notes);
                    $("#@notepadLastEditDate").text("Last edited on: " + data.data.lastEditDate);
                    $("#@notepadLoadingStatus").text("Successful notepad loading!");
                })
                .catch(function (data) {
                    $("#@notepadLoadingStatus").text(data);
                });
        }

        $(document).ready(function () {
            loadUserNotes();
        });
    </script>
}